---
tags:
  - Python
  - Pandas
  - æ•°æ®æ¸…æ´—
  - APIè¯¦è§£
aliases:
  - DataFrame
  - read_csv
  - dropna
  - Boolean Indexing
---

# Pandas æ•°æ®é¢„å¤„ç†è¯¦è§£

## 1. æ ¸å¿ƒå¯¹è±¡ï¼šDataFrame

**DataFrame** æ˜¯ Pandas çš„æ ¸å¿ƒï¼Œç›¸å½“äºä¸€å¼  Excel è¡¨æ ¼ã€‚

- **ç»“æ„**ï¼šå®ƒç”± **Index** (è¡Œæ ‡ç­¾)ã€**Columns** (åˆ—å) å’Œ **Data** (æ•°æ®çŸ©é˜µ) ç»„æˆã€‚
- **Series**ï¼šDataFrame çš„æ¯ä¸€åˆ—ï¼ˆæˆ–æ¯ä¸€è¡Œï¼‰å–å‡ºæ¥éƒ½æ˜¯ä¸€ä¸ª **Series**ï¼ˆå¸¦æœ‰æ ‡ç­¾çš„ä¸€ç»´æ•°ç»„ï¼‰ã€‚

## 2. æ•°æ®è¯»å– (I/O)

åœ¨ç¾èµ›ä¸­ï¼Œä½ ç»å¸¸ä¼šé‡åˆ°æ ¼å¼å¤æ€ªçš„æ•°æ®æ–‡ä»¶ï¼ˆæ¯”å¦‚ `.txt`, `.data`ï¼‰ã€‚

### `pd.read_csv()`

åŠŸèƒ½æœ€å¼ºå¤§çš„è¯»å–å‡½æ•°ã€‚

```python
df = pd.read_csv(filepath, sep=',', na_values=None, delim_whitespace=False)
```

- **å‚æ•°è¯¦è§£**ï¼š
  - `filepath`: æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ `'data/Auto.data'`ï¼‰ã€‚
  - `sep`: åˆ†éš”ç¬¦ã€‚é»˜è®¤æ˜¯ `,` (CSV)ã€‚å¦‚æœæ˜¯ Tab åˆ†éš”ï¼Œç”¨ `sep='\t'`ã€‚
  - `delim_whitespace`: **(ISLP ä¸“ç”¨ç¥å™¨)**
    - è®¾ä¸º `True` æ—¶ï¼Œè¡¨ç¤ºâ€œä»¥ä»»æ„é•¿åº¦çš„ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ï¼‰ä½œä¸ºåˆ†éš”ç¬¦â€ã€‚
    - **åœºæ™¯**ï¼šè¯»å–æ²¡æœ‰é€—å·ã€åªæ˜¯å¯¹é½æ’ç‰ˆçš„ `.data` æˆ– `.txt` æ–‡ä»¶ã€‚
  - `na_values`: **(é¿å‘å…³é”®)**
    - ä½œç”¨ï¼šæŒ‡å®šå“ªäº›å­—ç¬¦åº”è¢«è§†ä¸º NaNï¼ˆç¼ºå¤±å€¼ï¼‰ã€‚
    - **åœºæ™¯**ï¼šISLP çš„ `Auto` æ•°æ®é›†ä¸­ï¼Œç¼ºå¤±å€¼æ˜¯ç”¨é—®å· `?` è¡¨ç¤ºçš„ã€‚
    - **âš ï¸ åæœ**ï¼šå¦‚æœä½ ä¸å†™ `na_values=['?']`ï¼ŒPandas ä¼šæŠŠ `?` å½“ä½œå­—ç¬¦ä¸²è¯»å–ã€‚æ•´åˆ—ï¼ˆå¦‚ horsepowerï¼‰ä¼šå˜æˆ `object` (å­—ç¬¦ä¸²) ç±»å‹ï¼Œåç»­ç®—å‡å€¼æ—¶ç›´æ¥æŠ¥é”™ã€‚

## 3. æ•°æ®æ¢æŸ¥ (Inspection)

æ‹¿åˆ°æ•°æ®å…ˆçœ‹ä¸€çœ¼ï¼Œç¡®ä¿è¯»å–æ­£ç¡®ã€‚

Python

```python
print(df.columns)  # æŸ¥çœ‹åˆ—ååˆ—è¡¨
print(df.shape)    # æŸ¥çœ‹ (è¡Œæ•°, åˆ—æ•°)
print(df.info())   # (æœ€æ¨è) æŸ¥çœ‹æ¯åˆ—çš„æ•°æ®ç±»å‹å’Œéç©ºæ•°é‡
```

## 4. ç¼ºå¤±å€¼æ¸…æ´— (Cleaning)

### `df.dropna()`

Python

```python
clean_df = df.dropna(axis=0, how='any')
```

- **å‚æ•°è¯¦è§£**ï¼š
  - `axis`: `0` è¡¨ç¤ºåˆ è¡Œï¼ˆRowï¼‰ï¼Œ`1` è¡¨ç¤ºåˆ åˆ—ï¼ˆColumnï¼‰ã€‚é€šå¸¸åˆ è¡Œã€‚
  - `how`: `'any'` (åªè¦æœ‰ä¸€ä¸ª NaN å°±åˆ )ï¼Œ`'all'` (å…¨ä¸º NaN æ‰åˆ )ã€‚

### ğŸš‘ é«˜çº§æŠ€å·§ï¼šæ•°æ®å®¡è®¡ (å®¡è®¡åˆ äº†è°ï¼Ÿ)

å½“ä½ æ‰§è¡Œ `dropna()` åï¼Œæƒ³çŸ¥é“å…·ä½“å“ªå‡ è¡Œè¢«åˆ æ‰äº†ï¼ˆæ¯”å¦‚ä¸ºäº†å†™è®ºæ–‡çš„ Data Processing éƒ¨åˆ†ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ **é›†åˆ (Set)** è¿ç®—ï¼š

Python

```python
# 1. è·å–æ¸…æ´—å‰çš„ç´¢å¼•é›†åˆ
original_idx = set(df.index)

# 2. è·å–æ¸…æ´—åçš„ç´¢å¼•é›†åˆ
clean_idx = set(clean_df.index)

# 3. é›†åˆåšå·®ï¼šåŸæ¥çš„ - ç°åœ¨çš„ = æ¶ˆå¤±çš„
missing_rows = original_idx - clean_idx
print(f"è¢«åˆ é™¤çš„è¡Œå·: {missing_rows}")
```

## 5. ç´¢å¼•ä¸åˆ‡ç‰‡ (Selection)

è¿™æ˜¯ Pandas æœ€å®¹æ˜“æ··æ·†çš„åœ°æ–¹ã€‚

### åˆ—é€‰æ‹©

- `df['age']`: è¿”å› **Series** (ä¸€ç»´)ã€‚
- `df[['age', 'wage']]`: è¿”å› **DataFrame** (äºŒç»´)ã€‚**æ³¨æ„åŒå±‚ä¸­æ‹¬å·ï¼**

### è¡Œç­›é€‰ (Boolean Indexing)

ä¸æ¨èå†™ `for` å¾ªç¯ï¼Œè¦ä½¿ç”¨å¸ƒå°”æ©ç ã€‚

Python

```python
# 1. å®šä¹‰æ¡ä»¶ (ç”Ÿæˆä¸€ä¸ª True/False çš„ Series)
mask = df['year'] > 80

# 2. åº”ç”¨æ¡ä»¶
subset = df[mask]
```

- **å¤šæ¡ä»¶ç»„åˆ**ï¼šå¿…é¡»ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œå¹¶ä½¿ç”¨ä½è¿ç®—ç¬¦ `&` (å’Œ), `|` (æˆ–)ã€‚
  - `df[(df['year'] > 80) & (df['mpg'] > 30)]`

## 6. ç»˜å›¾æ¥å£ (Plotting)

Pandas å°è£…äº† Matplotlibï¼Œé€‚åˆå¿«é€Ÿæµè§ˆæ•°æ®ã€‚

### `df.plot.scatter()`

Python

```python
ax = df.plot.scatter(x='horsepower', y='mpg')
```

- **ä¼˜åŠ¿**ï¼šç›´æ¥ä¼ åˆ—åå­—ç¬¦ä¸²ï¼Œä¸ç”¨æŠŠæ•°æ®å–å‡ºæ¥ã€‚
- **è¿”å›å€¼**ï¼šè¿”å› `axes` å¯¹è±¡ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç»§ç»­ç”¨ Matplotlib çš„è¯­æ³•ä¿®é¥°å®ƒï¼š

Python

```python
ax.set_title("Horsepower vs MPG")
ax.set_xlabel("HP")
# æœ€åè®°å¾— plt.show()
```

## 7 å®æˆ˜é¿å‘ä¸æŠ€å·§ (Chapter 4 Lab æ›´æ–°)

### ç›¸å…³ç³»æ•°æŠ¥é”™ (ValueError)
å½“ DataFrame åŒ…å«å­—ç¬¦ä¸²åˆ—ï¼ˆå¦‚ 'Direction'ï¼‰æ—¶ï¼Œç›´æ¥è°ƒç”¨ `.corr()` ä¼šæŠ¥é”™ã€‚
**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ–¹æ³•1 (æ¨è)ï¼šæ˜¾å¼æŒ‡å®šåªè®¡ç®—æ•°å€¼åˆ—
df.corr(numeric_only=True)

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å‰”é™¤åˆ—
df.drop(columns=['Direction']).corr()
```
### ç»˜å›¾ç´¢å¼•é‡ç½® (Reset Index)

Pandas ç»˜å›¾é»˜è®¤ä½¿ç”¨ Index ä½œä¸º X è½´ã€‚å¦‚æœä½ æƒ³æŠŠ Indexï¼ˆæ¯”å¦‚å¹´ä»½ï¼‰å½“åšæ™®é€šåˆ—æ¥ç”»æ•£ç‚¹å›¾ï¼š

```python
# å°†ç´¢å¼•å˜æˆä¸€åˆ—ï¼Œåä¸º 'index' (æˆ–åŸç´¢å¼•å)
df.reset_index().plot(x='index', y='Volume', kind='scatter')
```

### æ ‡å‡†åŒ–åçš„ DataFrame é‡å»º

ä½¿ç”¨ `sklearn` çš„ `StandardScaler` åï¼Œåˆ—åä¼šä¸¢å¤±ã€‚é‡å»ºæ–¹æ³•ï¼š

```python
# å‡è®¾ scaler å·²ç» fit ä¸” X_std å·²ç»ç”Ÿæˆ
X_std_df = pd.DataFrame(
    X_std, 
    columns=feature_df.columns, 
    index=feature_df.index  # å…³é”®ï¼šåˆ«å¿˜äº†æŠŠåŸæ¥çš„è¡Œç´¢å¼•ï¼ˆå¦‚æ—¥æœŸï¼‰åŠ å›å»
)
```
## å…³è”ç¬”è®°

- æ¸…æ´—å®Œçš„æ•°æ®é€šå¸¸è½¬æ¢ä¸º NumPy æ•°ç»„è¿›å…¥æ¨¡å‹ï¼Œè§ [[NumPyæ•°ç»„æ“ä½œè¯¦è§£]]ã€‚
- ç»˜å›¾åº•å±‚åŸç†è§ [[Matplotlib ç»˜å›¾æ¡†æ¶è¯¦è§£]]ã€‚
- å»ºæ¨¡åº”ç”¨è§ [[çº¿æ€§å›å½’_statsmodelså®ç°]]ã€‚